<!DOCTYPE html>
<html>
  <head>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        font-size: 12px;
        font-family: Verdana;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: none;
      }

      .page-left,
      .page-right {
        min-width: 55px;
      }

      .page-break {
        clear: both;
      }

      .page-left,
      .page-right {
        min-width: 55px;
      }

      /* page-preview class disabled for PDF */

      .page-preview .preview-content {
        margin: auto;
        /* border: 1px solid #DADEE3; */
      }

      .page-preview .page-frame {
        border: 1px solid #dadee3;
        margin-left: -1px;
        margin-top: -1px;
        background-color: white;
      }

      body {
        font-family: Open Sans;
      }

      .page-fold {
        position: absolute;
        width: 15px;
        height: 1px;
        background-color: #999;
      }

      .page-fold-top {
        top: 35%;
      }

      .page-fold-bottom {
        bottom: 28%;
      }

      .footer {
        border-top: 1px solid #eaeaea;
        margin: 25px 0 20px 0;
        text-align: center;
        padding: 20px 0;
        font-size: 10px;
        color: #424242;
        position: relative;
      }

      .footer:after {
        content: '';
        position: absolute;
        right: -1px;
        top: -1px;
        height: 2px;
        width: 75px;
      }

      .footer-item {
        line-height: 14px;
        padding-left: 5px;
        padding-right: 5px;
        max-width: 100%;
      }

      .footer span {
        display: inline-block;
      }

      .header {
        padding-top: 54px;
      }

      .nowrap {
        white-space: nowrap;
      }

      .logo h2 {
        margin: 0;
        float: right;
        font-size: 19px;
        font-weight: bold;
      }

      .address {
        width: 50%;
        float: left;
      }

      .address-content {
        margin: 109px 10px 10px 22px;
      }

      .address .basic-address {
        color: #999;
        font-size: 9px;
        line-height: 14px;
        padding-bottom: 5px;
        min-height: 18px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #cust-name {
        font-weight: bold;
      }

      #cust-address {
        white-space: pre-wrap;
      }

      .basic-address #company-address {
        white-space: nowrap;
      }

      .logo {
        width: 50%;
        float: left;
      }

      .logo img {
        max-width: 100%;
        max-height: 150px;
        float: right;
      }

      .info {
        width: 100%;
        float: left;
        position: relative;
        margin-bottom: 40px;
      }

      .notes,
      .invoice-info-wrapper {
        float: left;
        width: 50%;
      }

      .notes {
        min-height: 10px;
      }

      #additional-notes,
      #notes-text {
        line-height: 16px;
        margin-left: 10px;
      }

      .additional-notes-text,
      #notes-text {
        white-space: pre-wrap;
      }

      #additional-notes {
        margin-top: 20px;
      }

      .page-break.page-actual-break + #additional-notes {
        margin-top: 0 !important;
      }

      #notes-text {
        position: absolute;
        bottom: 0;
        max-width: 48%;
        overflow: hidden;
        max-height: 128px;
      }

      .invoice-line-name,
      .invoice-line-description,
      .notes,
      #additional-notes,
      .footer-item {
        word-wrap: break-word;
        overflow: hidden;
      }

      .invoice-info h3 {
        margin: 0 0 6px;
        padding: 10px;
        font-size: 12px;
        font-weight: 600;
        border-bottom: 1px solid #eaeaea;
      }

      .invoice-info .line {
        padding: 6px 10px;
      }

      .line-bold {
        font-weight: 600;
        font-size: 12px;
      }

      .invoice-info span.value {
        float: right;
      }

      .invoice-info div.amount {
        font-weight: bold;
        background-color: #eaeaea;
      }

      .invoice-lines-table-wrapper {
        width: 100%;
      }

      table {
        transform: translate(0);
        width: 100%;
        border-collapse: collapse;
      }

      td {
        vertical-align: top;
      }

      td.td-product-number,
      td.td-quantity,
      td.td-unit,
      td.td-price,
      td.td-line-discount,
      td.td-line-total,
      td.td-vat {
        width: 10px;
        /* will auto adjust */
      }

      td.td-unit,
      td.td-product-number {
        white-space: nowrap;
      }

      td.td-product {
        max-width: 10px;
        /* will auto adjust */
      }

      td.quantity,
      #invoice-total .value {
        text-align: right;
        white-space: nowrap;
      }

      td.td-line-total,
      td.td-price {
        text-align: right;
      }

      #invoice-total .empty-line {
        padding: 2px 10px;
      }

      #invoice-total .value,
      td.td-line-total {
        width: 1%;
        min-width: 75px;
        box-sizing: border-box;
      }

      .table-subtotal,
      .table-head {
        display: none;
      }

      .table-subtotal td {
        text-align: right;
      }

      .table-subtotal .subtotal-amount {
        margin: 0 5px 0 10px;
      }

      tr.show {
        display: table-row !important;
      }

      .table-head {
        background-color: #eaeaea;
      }

      .table-head td {
        padding: 5px 10px;
        white-space: nowrap;
        border: 1px solid #eaeaea;
      }

      .table-line td {
        padding: 5px 10px;
        border: 1px solid #eaeaea;
      }

      .invoice-line-description {
        margin-top: 5px;
        white-space: pre-wrap;
        color: #646473;
        font-size: 11px;
      }

      .invoice-line-description:empty {
        display: none;
      }

      .subtotal-space {
        height: 35px;
      }

      .subtotal-abs-space {
        height: 30px;
      }

      .subtotal-abs-gutter {
        position: absolute;
        right: 0;
        margin: -17px 4px 0 0;
      }

      .clear {
        clear: both;
      }

      #invoice-total {
        margin-top: 20px;
        padding-left: 30px;
        width: 50%;
        float: right;
      }

      #invoice-total.noTax {
        margin-top: 40px;
      }

      .page-break.page-actual-break + #invoice-total {
        margin-top: 0 !important;
      }

      #invoice-total td {
        white-space: nowrap;
        padding: 6px 10px;
      }

      #invoice-total .amount td {
        padding: 7px 10px;
        background-color: #eaeaea;
        font-weight: bold;
        font-size: 12px;
        line-height: 18px;
      }

      .signature {
        font-size: 16px;
        padding-top: 40px;
      }

      .signature__label {
        font-size: 12px;
      }

      .des2-header-fullsize {
        position: absolute;
        left: -55px;
        right: -55px;
        height: 276px;
        top: 0;
        overflow: hidden;
      }

      .print .des2-header-image__text {
        display: none;
      }

      .des-customer-number {
        display: none;
      }

      .td-product-number {
        display: none;
      }

      .signature {
        display: none;
      }

      .td-vat {
        display: none;
      }

      .must-show {
        display: table-cell !important;
      }

      .hidden {
        display: none;
      }

      .table-line td.td-product-img {
        width: 40px;
        height: 32px;
        text-align: center;
        vertical-align: middle;
      }

      .td-product-img img {
        max-width: 40px;
        max-height: 32px;
      }

      .header-block {
        padding: 0 25px;
        overflow: hidden;
        min-height: 81px;
      }

      .header-block__logo {
        float: right;
        width: inherit;
        max-width: 280px;
        height: 80px;
      }

      .header-block__company-name {
        width: 50%;
        float: left;
        font-size: 20px;
        margin: 24px 0;
        font-weight: normal;
        color: #313140;
      }

      .invoice-block {
        padding: 0 25px;
        margin-top: 20px;
        overflow: hidden;
      }

      .customer-details {
        float: left;
        width: 50%;
      }

      .base-text {
        font-size: 13px;
        line-height: 24px;
        color: #646473;
      }

      .customer-details__address {
        white-space: normal;
      }

      .invoice-info {
        padding: 0;
        float: right;
        width: 280px;
      }

      .invoice-info__lines {
        margin-top: 13px;
      }

      .notes {
        margin-top: 58px;
        padding: 0 25px;
        box-sizing: border-box;
        width: 100%;
        white-space: pre-wrap;
      }

      .invoice-table {
        margin-top: 58px;
        padding: 0 25px;
        box-sizing: border-box;
        width: 100%;
      }

      .table-head td {
        border-width: 0 0 1px 0;
      }

      .invoice-table td {
        padding: 0;
      }

      .invoice-table td + td {
        padding-left: 10px;
      }

      .invoice-table__line td {
        padding: 13px 0;
        border-bottom: 1px solid #e5e5e5;
      }

      .invoice-table__description {
        color: #646473;
        white-space: normal;
        font-size: 10px;
        line-height: 20px;
      }

      .invoice-table__line td.td-product-img {
        padding: 9px 10px 0 0;
        width: 40px;
        text-align: center;
      }

      .table-head td.td-product-img {
        background: #fff;
      }

      .header-text,
      .signature__label,
      h3.header-text,
      td.header-text {
        background: white;
        font-size: 13px;
        font-style: italic;
        padding: 0 0 13px 0;
      }

      .header-text {
        color: #313140;
        border-color: #e5e5e5;
        border: none;
      }

      .print .header-text {
        border-top: none !important;
        border-left: none !important;
        border-right: none !important;
      }

      td.header-text {
        padding: 6px 0 8px;
      }

      .print td.header-text {
        border-left: none !important;
        border-right: none !important;
      }

      .table-text {
        text-align: left;
      }

      .table-number {
        text-align: right;
      }

      .invoice-total-table {
        margin: 58px 25px 0 0;
        width: 280px;
        float: right;
      }

      .invoice-total-table__amount {
        font-size: 15px;
        font-weight: 600;
        /* semi bold */
        color: #313140;
      }

      .page-bottom .footer {
        text-align: left;
        color: #646473;
        padding: 20px 25px;
        margin: auto;
        font-size: 12px;
        border-top: none;
      }

      .page-bottom .footer:before {
        content: '';
        position: absolute;
        top: 0;
        left: 25px;
        right: 25px;
        border-top: 2px solid #eaeaea;
      }

      .footer-item {
        padding: 0;
        overflow: visible;
        margin-right: 10px;
      }

      .additional-notes {
        padding: 25px 25px 0;
      }

      .signature {
        padding-left: 25px;
      }

      .base-text {
        color: #000000;
      }

      td + td.td-description {
        padding-left: 0;
      }

      .header-text,
      .header-block__company-name,
      .invoice-total-table__amount {
        color: #000000;
      }

      .td-vat {
        display: none;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      media="all"
    />
  </head>

  <body class="page-preview print">
    <div class="preview-content" style="width: 794px;">
      <div
        class="page-canvas"
        style="width: 684px; margin-left: 55px; height: auto;"
      >
        <div class="header-block">
          <h2 class="header-block__company-name">
            <%= devis.companyData.nomEntreprise.trim() %>
          </h2>
          <img class="header-block__logo" src="<%=devis.companyLogo.trim()%>" />
        </div>
        <div class="page-break page-break-visited"></div>

        <div class="invoice-block">
          <div class="customer-details base-text">
            <div class="customer-details__address">
              <%= devis.client.nomClient.trim() %>
            </div>
            <div class="customer-details__address">
              <%= devis.client.adressClient.trim() %>
            </div>
            <div class="customer-details__address">
              <%= devis.client.emailClient.trim() %>
            </div>
            <div class="customer-details__address">
              <%= devis.client.telephonClient.trim() %>
            </div>
            <div id="cust-ci-or-vat">
              <div id="cust-ci">
                N° TVA UE <%= devis.client.numTvaClient.trim() %>
              </div>
            </div>
            <div class="customer-details__address">
              <%= devis.client.paysClient.trim() %>
            </div>
          </div>
          <div class="invoice-info">
            <h3 class="header-text">
              Devis n°<%= devis.numDevis.trim() %>
            </h3>
            <div class="invoice-info__lines">
              <div class="base-text">
                <label><span>Date de Devis</span></label>
                <span class="value"><%= devis.dateDevis.trim()%></span>
              </div>
              <div class="base-text">
                <label><span>Validité</span></label>
                <span class="value"><%= devis.dateValiditeDevis.trim()%></span>
              </div>
              <div class="base-text des-customer-number">
                <label><span>Numéro de client</span></label>
                <span class="value"><%= devis.client.numClient.trim()%></span>
              </div>
            </div>
          </div>
        </div>

        <div class="notes base-text">
          <%= devis.notesDevis.trim()%>
        </div>

        <div class="page-break page-break-visited"></div>

        <div class="invoice-table">
          <table id="invoice-lines-table">
            <tbody id="invoice-lines">
              <tr class="table-head show">
                <!--   <td class="table-text td-product-img"></td>
            <td class="header-text td-product-number">N°</td> -->
                <td class="header-text td-description table-text">
                  Description
                </td>
                <td class="td-quantity header-text table-number">Quantité</td>
                <td class="td-unit header-text table-text">Unité</td>
                <td class="td-price header-text table-number">Prix</td>
                <td class="td-line-discount header-text table-number">
                  Réduc.
                </td>
                <td class="td-vat header-text table-number must-show">TVA</td>
                <td class="td-line-total header-text table-number">Montant</td>
              </tr>

              <% if (devis.lignesDevis.length > 0){%>
              <%devis.lignesDevis.forEach((ligneDevis)=>{%>
              <tr class="invoice-table__line base-text">
                <td class="table-text td-description">
                  <div class=""><%= ligneDevis.produit %></div>
                  <div class="invoice-table__description">
                    <%= ligneDevis.description %>
                  </div>
                </td>
                <td class="td-quantity table-number">
                  <%= ligneDevis.quantite %>
                </td>
                <td class="td-unit table-text"><%= ligneDevis.unite %></td>
                <td class="td-price table-number"><%= ligneDevis.prix %></td>
                <td class="td-line-discount table-number">
                  <%= ligneDevis.reduction %>%
                </td>
                <td class="td-vat must-show"><%= ligneDevis.tva %>%</td>
                <td class="td-line-total table-number">
                  <%= (ligneDevis.quantite * ligneDevis.prix * (100-
                  ligneDevis.reduction)) / 100 %>
                </td>
              </tr>
              <tr class="page-break page-break-visited"></tr>
              <tr class="page-break page-break-visited"></tr>
              <%});%> <%}%>
            </tbody>
          </table>
        </div>

        <div class="page-break page-break-visited"></div>
        <table class="invoice-total-table">
          <tbody class="base-text">
            <tr>
              <td>Sous-total HT</td>
              <td class="table-number">
                <%=
                devis.lignesDevis.map(ligneDevis=>((ligneDevis.quantite*ligneDevis.prix)*((100-ligneDevis.reduction)/100))).reduce(function(a,
                b){return a+b;})%>
              </td>
            </tr>
            <% if (devis.lignesDevis.length > 0 ){ %> <% var
            lignesDevisTva0Prcent = devis.lignesDevis.filter( ligneDevis=>
            ligneDevis.tva == 0 ); var lignesDevisTva6Prcent =
            devis.lignesDevis.filter( ligneDevis => ligneDevis.tva == 6 ); var
            lignesDevisTva12Prcent = devis.lignesDevis.filter( ligneDevis =>
            ligneDevis.tva == 12 ); var lignesDevisTva21Prcent =
            devis.lignesDevis.filter( ligneDevis => ligneDevis.tva == 21 );%>
            <%if(lignesDevisTva0Prcent.length>0){ %> <% var zero =
            lignesDevisTva0Prcent .map( ligneDevis => ligneDevis.quantite *
            ligneDevis.prix * (1 - ligneDevis.reduction / 100) )
            .reduce(function(a, b) { return a + b; }); %>
            <tr>
              <td>
                TVA 0% <i>de</i>
                <%=zero%>
              </td>
              <td class="table-number">
                <%= lignesDevisTva0Prcent .map( ligneDevis =>
                (ligneDevis.quantite * ligneDevis.prix * (100 -
                ligneDevis.reduction) * ligneDevis.tva) / 10000
                ).reduce(function(a, b) {return a + b;}) %>
              </td>
            </tr>
            <% } %> <%if(lignesDevisTva6Prcent.length>0){ %> <% var six
            =lignesDevisTva6Prcent.map( ligneDevis => ligneDevis.quantite *
            ligneDevis.prix * (1 - ligneDevis.reduction / 100) )
            .reduce(function(a, b) { return a + b; });%>
            <tr>
              <td>
                TVA 6% <i>de</i>
                <%=six%>
              </td>
              <td class="table-number">
                <%= lignesDevisTva6Prcent .map( ligneDevis =>
                (ligneDevis.quantite * ligneDevis.prix * (100 -
                ligneDevis.reduction) * ligneDevis.tva) / 10000
                ).reduce(function(a, b) {return a + b;}) %>
              </td>
            </tr>
            <% } %> <%if(lignesDevisTva12Prcent.length>0){ %> <% var douze =
            lignesDevisTva12Prcent .map( ligneDevis => ligneDevis.quantite *
            ligneDevis.prix * (1 - ligneDevis.reduction / 100) )
            .reduce(function(a, b) { return a + b; });%>
            <tr>
              <td>
                TVA 12%
                <i>de</i>
                <%=douze%>
              </td>
              <td class="table-number">
                <%= lignesDevisTva12Prcent .map( ligneDevis =>
                (ligneDevis.quantite * ligneDevis.prix * (100 -
                ligneDevis.reduction) * ligneDevis.tva) / 10000
                ).reduce(function(a, b) {return a + b;})%>
              </td>
            </tr>
            <% } %> <%if(lignesDevisTva21Prcent.length>0){ %> <% var vingtUn =
            lignesDevisTva21Prcent .map( ligneDevis => ligneDevis.quantite *
            ligneDevis.prix * (1 - ligneDevis.reduction / 100) )
            .reduce(function(a, b) { return a + b; });%>
            <tr>
              <td>
                TVA 21%
                <i>de</i>
                <%=vingtUn%>
              </td>
              <td class="table-number">
                <%= lignesDevisTva21Prcent .map( ligneDevis =>
                (ligneDevis.quantite * ligneDevis.prix * (100 -
                ligneDevis.reduction) * ligneDevis.tva) / 10000
                ).reduce(function(a, b) {return a + b;}) %>
              </td>
            </tr>
            <% } %> <% } %>

            <tr class="invoice-total-table__amount">
              <td>Montant Total EUR</td>
              <td class="table-number">
                <%= devis.lignesDevis .map( ligneDevis => (ligneDevis.quantite *
                ligneDevis.prix * ((100 - ligneDevis.reduction) * ligneDevis.tva
                + 100 * (100 - ligneDevis.reduction))) / 10000 )
                .reduce(function(a, b) { return a + b; }) %>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="notes base-text">
          <%= devis.conditionDevis.trim() %>
        </div>

        <div
          class="page-bottom"
          id="pageFooter"
          style="width: 684px; top: 949px; margin: auto;"
        >
          <div class="subtotal-space"></div>
          <div class="footer">
            <span class="footer-item">
              <%=devis.companyData.nomEntreprise.trim()%>
            </span>
            <span class="footer-item">
              <%=devis.companyData.adresseEntreprise.trim()%>
            </span>
            <span class="footer-item nowrap">
              E-mail :
              <span> <%=devis.companyData.emailEntreprise.trim()%> </span>
            </span>
            <span class="nowrap footer-item">
              Téléphone :
              <span><%=devis.companyData.telephoneNumberEnt.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              Site Internet :
              <span><%=devis.companyData.webSite.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              n° SIREN / SIRET :
              <span><%=devis.companyData.companyNumber.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              N° TVA:
              <span><%=devis.companyData.vatNumber.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              Banque :
              <span><%=devis.companyData.bankName.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              Code banque:
              <span><%=devis.companyData.bankNumber.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              N° du compte:
              <span><%=devis.companyData.bankAccount.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              Titulaire du compte :
              <span><%=devis.companyData.accountHolderName.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              BIC :
              <span><%=devis.companyData.swiftCode.trim()%></span>
            </span>
            <span class="nowrap footer-item">
              IBAN :
              <span><%=devis.companyData.ibanCode.trim()%></span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
